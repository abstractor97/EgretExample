var __reflect=this&&this.__reflect||function(e,t,o){e.__class__=t,o?o.push(t):o=[t],e.__types__=e.__types__?o.concat(e.__types__):o},__extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,o){function n(n){t.call(o,n,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?n(s):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var WxUtils=function(e){function t(){var t=e.apply(this,arguments)||this;return t.title="微信分享测试标题",t.desc="微信分享测试描述",t.link="http://baidu.com",t.imgUrl="http://120.24.188.118/Example/weixin/resource/assets/share.jpg",t}return __extends(t,e),t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.config=function(e){var o=new BodyConfig;o.debug=e.debug,o.appId=e.appId,o.timestamp=e.timestamp,o.nonceStr=e.nonceStr,o.signature=e.signature,o.jsApiList=["onMenuShareTimeline","onMenuShareAppMessage","chooseImage","previewImage","uploadImage","downloadImage","startRecord","stopRecord","onVoiceRecordEnd","playVoice","pauseVoice","stopVoice","onVoicePlayEnd","uploadVoice","downloadVoice","translateVoice","openLocation","getLocation"],wx&&(wx.config(o),wx.error(function(){}),wx.ready(function(){t.getInstance().setShareContent()}))},t.prototype.setShareContent=function(e){void 0===e&&(e=this.title),this.shareTimeLine(e),this.shareAppMessage(e),this.shareQQ(e),this.shareWeiBo(e)},t.prototype.shareTimeLine=function(e){var t=new BodyMenuShareTimeline;t.title=e,t.imgUrl=this.imgUrl,t.link=this.link,t.success=function(){},t.fail=function(){},t.cancel=function(){},wx.onMenuShareTimeline(t)},t.prototype.shareAppMessage=function(e){var t=new BodyMenuShareAppMessage;t.title=e,t.imgUrl=this.imgUrl,t.link=this.link,t.desc=this.desc,t.success=function(){},wx.onMenuShareAppMessage(t)},t.prototype.shareQQ=function(e){var t=new BodyMenuShareQQ;t.title=e,t.desc=this.desc,t.link=this.link,t.imgUrl=this.imgUrl,t.success=function(){},wx.onMenuShareQQ(t)},t.prototype.shareWeiBo=function(e){var t=new BodyMenuShareWeibo;t.title=e,t.desc=this.desc,t.link=this.link,t.imgUrl=this.imgUrl,wx.onMenuShareWeibo(t)},t.prototype.chooseImg=function(){var e={count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){var o=e.localIds;t.getInstance().dispatchEventWith(t.CHOOSE_IMAGE_SUCCESS,!1,o)},fail:function(){}};wx.chooseImage(e)},t.prototype.previewImage=function(){},t.prototype.uploadImage=function(e){wx.uploadImage({localId:e,isShowProgressTips:1,success:function(e){var o=e.serverId;t.getInstance().dispatchEventWith(t.UPLOAD_IMAGE_SUCCESS,!1,o)}})},t.prototype.downloadImage=function(e){wx.downloadImage({serverId:e,isShowProgressTips:1,success:function(e){var o=e.localId;t.getInstance().dispatchEventWith(t.DOWNLOAD_IMAGE_SUCCESS,!1,o)}})},t.prototype.startRecord=function(){wx.startRecord({}),wx.onVoiceRecordEnd({complete:function(e){var o=e.localId;t.getInstance().dispatchEventWith(t.STOP_RECORD,!1,o)}})},t.prototype.stopRecord=function(){wx.stopRecord({success:function(e){var o=e.localId;t.getInstance().dispatchEventWith(t.STOP_RECORD,!1,o)}})},t.prototype.playVoice=function(e){wx.playVoice({localId:e}),wx.onVoicePlayEnd({success:function(e){var o=e.localId;t.getInstance().dispatchEventWith(t.VOICE_PLAY_END,!1,o)}})},t.prototype.pauseVoice=function(e){wx.pauseVoice({localId:e})},t.prototype.stopVoice=function(e){wx.stopVoice({localId:e})},t.prototype.uploadVoice=function(e){wx.uploadVoice({localId:e,isShowProgressTips:1,success:function(e){var o=e.serverId;t.getInstance().dispatchEventWith(t.UPLOAD_VOICE_SUCCESS,!1,o)}})},t.prototype.downloadVocie=function(e){wx.downloadVoice({serverId:e,isShowProgressTips:1,success:function(e){var o=e.localId;t.getInstance().dispatchEventWith(t.DOWNLOAD_VOICE_SUCCESS,!1,o)}})},t.prototype.translateVoice=function(e){wx.translateVoice({localId:e,isShowProgressTips:1,success:function(e){var o=e.translateResult;t.getInstance().dispatchEventWith(t.TRANSLATE_VOICE_SUCCESS,!1,o)}})},t.prototype.openLocation=function(e,t,o,n,s,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===o&&(o=""),void 0===n&&(n=""),void 0===s&&(s=1),void 0===i&&(i=""),wx.openLocation({latitude:e,longitude:t,name:o,address:n,scale:s,infoUrl:i})},t.prototype.getLocation=function(e){void 0===e&&(e="wgs84"),wx.getLocation({type:e,success:function(e){e.latitude,e.longitude,e.speed,e.accuracy;t.getInstance().dispatchEventWith(t.GET_LOCATION_SUCCESS,!1,e)}})},t}(egret.EventDispatcher);WxUtils.CHOOSE_IMAGE_SUCCESS="CHOOSE_IMAGE_SUCCESS",WxUtils.UPLOAD_IMAGE_SUCCESS="UPLOAD_IMAGE_SUCCESS",WxUtils.DOWNLOAD_IMAGE_SUCCESS="DOWNLOAD_IMAGE_SUCCESS",WxUtils.STOP_RECORD="STOP_RECORD",WxUtils.VOICE_PLAY_END="VOICE_PLAY_END",WxUtils.UPLOAD_VOICE_SUCCESS="UPLOAD_VOICE_SUCCESS",WxUtils.DOWNLOAD_VOICE_SUCCESS="DOWNLOAD_VOICE_SUCCESS",WxUtils.TRANSLATE_VOICE_SUCCESS="TRANSLATE_VOICE_SUCCESS",WxUtils.GET_LOCATION_SUCCESS="GET_LOCATION_SUCCESS",__reflect(WxUtils.prototype,"WxUtils");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,o,n){function s(e){t.call(n,e)}function i(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),o.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Main=function(e){function t(){var t=e.apply(this,arguments)||this;return t.isThemeLoadEnd=!1,t.isResourceLoadEnd=!1,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json?v="+window.version,"resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json?v="+window.version,this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},t.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.startCreateScene=function(){this.addChild(new HomeScene),new WebChat},t}(eui.UILayer);__reflect(Main.prototype,"Main");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Http=function(){function e(){this.httpMethod=egret.HttpMethod.GET,this.cacheList=[],this.requesting=!1,this.request=new egret.HttpRequest,this.request.responseType=egret.HttpResponseType.TEXT,this.request.addEventListener(egret.Event.COMPLETE,this.onPostComplete,this),this.request.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this)}return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.initServerUrl=function(e){this.serverUrl=e},e.prototype.send=function(e,t,o){this.httpMethod==egret.HttpMethod.GET?this.cacheList.push([null,t,o]):this.cacheList.push([JSON.stringify(e),t,o]),this.next()},e.prototype.next=function(){this.requesting||0!=this.cacheList.length&&(this.curSend=this.cacheList.shift(),this.request.open(this.serverUrl,this.httpMethod),this.request.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.httpMethod==egret.HttpMethod.GET?this.request.send():this.request.send(this.curSend[0]),this.requesting=!0)},e.prototype.onPostComplete=function(e){egret.log("postComplete"),this.curSend&&this.curSend[1].call(this.curSend[2],this.request.response),this.requesting=!1,this.next()},e.prototype.onPostIOError=function(e){egret.error("Http send error:",e.data),this.requesting=!1,this.next()},e.prototype.clearAllRequest=function(){this.request.abort(),this.curSend=null,this.cacheList.length=0},e}();__reflect(Http.prototype,"Http");var HomeScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="HomeSceneSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){WxUtils.getInstance().config(window.wxInfo),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},t.prototype.onTouchTap=function(e){switch(e.target){case this.chooseImgBtn:this.onChooseImg();break;case this.uploadImgBtn:this.onUploadImg();break;case this.startRecordBtn:this.onStartRecord();break;case this.stopRecordBtn:this.onStopRecord();break;case this.playVoiceBtn:this.onPlayVocie();break;case this.pauseVoiceBtn:this.onPauseVoice();break;case this.stopVoiceBtn:this.onStopVoice();break;case this.uploadVoiceBtn:this.uploadVoice();break;case this.downloadVoiceBtn:this.downloadVoice();break;case this.translateVoiceBtn:this.translateVoice();break;case this.getLocationBtn:this.getLocation()}},t.prototype.onChooseImg=function(){WxUtils.getInstance().addEventListener(WxUtils.CHOOSE_IMAGE_SUCCESS,this.onChooseImgSuccess,this),WxUtils.getInstance().chooseImg()},t.prototype.onChooseImgSuccess=function(e){this.imgLocalIds=e.data,egret.log("选择图片成功:",this.imgLocalIds[0]);var t=document.createElement("img"),o=this.chooseImg;t.onload=function(){var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);var s=e.toDataURL("image/jpeg");o.source=s},t.src=this.imgLocalIds[0]},t.prototype.onUploadImg=function(){var e=this.imgLocalIds[0];WxUtils.getInstance().addEventListener(WxUtils.UPLOAD_IMAGE_SUCCESS,this.uploadImgSuccess,this),WxUtils.getInstance().uploadImage(e)},t.prototype.uploadImgSuccess=function(e){var t=e.data;egret.log("上传图片成功:",t),WxUtils.getInstance().addEventListener(WxUtils.DOWNLOAD_IMAGE_SUCCESS,this.downloadImgSuccess,this),WxUtils.getInstance().downloadImage(t)},t.prototype.downloadImgSuccess=function(e){var t=e.data;egret.log("下载图片成功:",t)},t.prototype.onStartRecord=function(){WxUtils.getInstance().startRecord()},t.prototype.onStopRecord=function(){WxUtils.getInstance().addEventListener(WxUtils.STOP_RECORD,this.stopRecordSuccess,this),WxUtils.getInstance().stopRecord()},t.prototype.stopRecordSuccess=function(e){var t=e.data;egret.log("停止录音:",t),this.voiceLocalId=t},t.prototype.onPlayVocie=function(){WxUtils.getInstance().addEventListener(WxUtils.VOICE_PLAY_END,this.onVoicePlayEnd,this),WxUtils.getInstance().playVoice(this.voiceLocalId)},t.prototype.onVoicePlayEnd=function(){egret.log("录音播放结束")},t.prototype.onPauseVoice=function(){WxUtils.getInstance().pauseVoice(this.voiceLocalId)},t.prototype.onStopVoice=function(){WxUtils.getInstance().stopVoice(this.voiceLocalId)},t.prototype.uploadVoice=function(){WxUtils.getInstance().addEventListener(WxUtils.UPLOAD_VOICE_SUCCESS,this.uploadVoiceSuccess,this),WxUtils.getInstance().uploadVoice(this.voiceLocalId)},t.prototype.uploadVoiceSuccess=function(e){var t=e.data;egret.log("上传录音成功:",t),this.voiceServerId=t},t.prototype.downloadVoice=function(){WxUtils.getInstance().addEventListener(WxUtils.DOWNLOAD_VOICE_SUCCESS,this.downlodVoiceSuccess,this),WxUtils.getInstance().downloadVocie(this.voiceServerId)},t.prototype.downlodVoiceSuccess=function(e){var t=e.data;egret.log("下载录音成功:",t)},t.prototype.translateVoice=function(){WxUtils.getInstance().addEventListener(WxUtils.TRANSLATE_VOICE_SUCCESS,this.translateVoiceSuccess,this),WxUtils.getInstance().translateVoice(this.voiceLocalId)},t.prototype.translateVoiceSuccess=function(e){var t=e.data;egret.log("音频识别:",t)},t.prototype.getLocation=function(){WxUtils.getInstance().addEventListener(WxUtils.GET_LOCATION_SUCCESS,this.getLocationSuccess,this),WxUtils.getInstance().getLocation("gcj02")},t.prototype.getLocationSuccess=function(e){var t=e.data;WxUtils.getInstance().openLocation(t.latitude,t.longitude,"地理位置测试")},t}(eui.Component);__reflect(HomeScene.prototype,"HomeScene");var WebChat=function(){function e(){var e=egret.getOption("code"),t=egret.getOption("state");egret.log("code:",e),egret.log("state:",t),window.getToken(e)}return e.prototype.getAccessToken=function(e){egret.log("get data : ",e)},e}();__reflect(WebChat.prototype,"WebChat");